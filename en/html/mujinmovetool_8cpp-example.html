<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>controllerclientcpp: mujinmovetool.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">controllerclientcpp
   &#160;<span id="projectnumber">0.6.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">mujinmovetool.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Shows how to move tool to a specified position and orientation in two ways. example1: mujinmovetool &ndash;controller_hostname=yourhost &ndash;robotname=yourrobot &ndash;goals=700 600 500 0 0 180 example2: mujinmovetool &ndash;controller_hostname=yourhost &ndash;robotname=yourrobot &ndash;goals=700 600 500 0 0 180 &ndash;goaltype=translationdirection5d &ndash;movelinear=true</p>
<div class="fragment"><div class="line"><span class="comment">// -*- coding: utf-8 -*-</span></div>
<div class="line"><span class="comment"></span><span class="preprocessor">#include &lt;<a class="code" href="binpickingtask_8h.html">mujincontrollerclient/binpickingtask.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(_WIN32) || defined(_WIN64)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#undef GetUserName // clashes with ControllerClient::GetUserName</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif // defined(_WIN32) || defined(_WIN64)</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>mujinclient;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;boost/program_options.hpp&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>bpo = boost::program_options;</div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">string</span> <a name="a0"></a><a class="code" href="mujinjog_8cpp.html#a44f93965ae092cf23ff35997031b2415">s_robotname</a>;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> <a name="a1"></a><a class="code" href="mujinjog_8cpp.html#a6f58488a42ca5b7dd063aa3a7641e60e" title="parse command line options and store in a map">ParseOptions</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv, bpo::variables_map&amp; opts)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// parse command line arguments</span></div>
<div class="line">    bpo::options_description desc(<span class="stringliteral">&quot;Options&quot;</span>);</div>
<div class="line"></div>
<div class="line">    desc.add_options()</div>
<div class="line">        (<span class="stringliteral">&quot;help,h&quot;</span>, <span class="stringliteral">&quot;produce help message&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;controller_hostname&quot;</span>, bpo::value&lt;string&gt;()-&gt;required(), <span class="stringliteral">&quot;hostname or ip of the mujin controller, e.g. controllerXX or 192.168.0.1&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;controller_port&quot;</span>, bpo::value&lt;unsigned int&gt;()-&gt;default_value(80), <span class="stringliteral">&quot;port of the mujin controller&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;slave_request_id&quot;</span>, bpo::value&lt;string&gt;()-&gt;default_value(<span class="stringliteral">&quot;&quot;</span>), <span class="stringliteral">&quot;request id of the mujin slave, e.g. controller20_slave0. If empty, uses  &quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;controller_username_password&quot;</span>, bpo::value&lt;string&gt;()-&gt;default_value(<span class="stringliteral">&quot;testuser:pass&quot;</span>), <span class="stringliteral">&quot;username and password to the mujin controller, e.g. username:password&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;controller_command_timeout&quot;</span>, bpo::value&lt;double&gt;()-&gt;default_value(10), <span class="stringliteral">&quot;command timeout in seconds, e.g. 10&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;locale&quot;</span>, bpo::value&lt;string&gt;()-&gt;default_value(<span class="stringliteral">&quot;en_US&quot;</span>), <span class="stringliteral">&quot;locale to use for the mujin controller client&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;task_scenepk&quot;</span>, bpo::value&lt;string&gt;()-&gt;default_value(<span class="stringliteral">&quot;&quot;</span>), <span class="stringliteral">&quot;scene pk of the binpicking task on the mujin controller, e.g. officeboltpicking.mujin.dae.&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;robotname&quot;</span>, bpo::value&lt;string&gt;()-&gt;default_value(<span class="stringliteral">&quot;&quot;</span>), <span class="stringliteral">&quot;robot name.&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;taskparameters&quot;</span>, bpo::value&lt;string&gt;()-&gt;default_value(<span class="stringliteral">&quot;{}&quot;</span>), <span class="stringliteral">&quot;binpicking task parameters, e.g. {&#39;robotname&#39;: &#39;robot&#39;, &#39;robots&#39;:{&#39;robot&#39;: {&#39;externalCollisionIO&#39;:{}, &#39;gripperControlInfo&#39;:{}, &#39;robotControllerUri&#39;: &#39;&#39;, robotDeviceIOUri&#39;: &#39;&#39;, &#39;toolname&#39;: &#39;tool&#39;}}}&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;zmq_port&quot;</span>, bpo::value&lt;unsigned int&gt;()-&gt;default_value(11000), <span class="stringliteral">&quot;port of the binpicking task on the mujin controller&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;heartbeat_port&quot;</span>, bpo::value&lt;unsigned int&gt;()-&gt;default_value(11001), <span class="stringliteral">&quot;port of the binpicking task&#39;s heartbeat signal on the mujin controller&quot;</span>)</div>
<div class="line"></div>
<div class="line">        (<span class="stringliteral">&quot;toolname&quot;</span>, bpo::value&lt;string&gt;()-&gt;default_value(<span class="stringliteral">&quot;&quot;</span>), <span class="stringliteral">&quot;tool name, e.g. flange&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;goaltype&quot;</span>, bpo::value&lt;string&gt;()-&gt;default_value(<span class="stringliteral">&quot;transform6d&quot;</span>), <span class="stringliteral">&quot;mode to move tool with. Either transform6d or translationdirection5d&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;goals&quot;</span>, bpo::value&lt;vector&lt;double&gt; &gt;()-&gt;multitoken(), <span class="stringliteral">&quot;goal to move tool to, \&#39;X Y Z RX RY RZ\&#39;. Units are in mm and deg.&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;speed&quot;</span>, bpo::value&lt;double&gt;()-&gt;default_value(0.1), <span class="stringliteral">&quot;speed to move at&quot;</span>)</div>
<div class="line">        (<span class="stringliteral">&quot;movelinear&quot;</span>, bpo::value&lt;bool&gt;()-&gt;default_value(<span class="keyword">false</span>), <span class="stringliteral">&quot;whether to move tool linearly&quot;</span>)</div>
<div class="line">        ;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        bpo::store(bpo::parse_command_line(argc, argv, desc, bpo::command_line_style::unix_style ^ bpo::command_line_style::allow_short), opts);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> exception&amp; ex) {</div>
<div class="line">        stringstream errss;</div>
<div class="line">        errss &lt;&lt; <span class="stringliteral">&quot;Caught exception &quot;</span> &lt;&lt; ex.what();</div>
<div class="line">        cerr &lt;&lt; errss.str() &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">bool</span> badargs = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        bpo::notify(opts);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span>(<span class="keyword">const</span> exception&amp; ex) {</div>
<div class="line">        stringstream errss;</div>
<div class="line">        errss &lt;&lt; <span class="stringliteral">&quot;Caught exception &quot;</span> &lt;&lt; ex.what();</div>
<div class="line">        cerr &lt;&lt; errss.str() &lt;&lt; endl;</div>
<div class="line">        badargs = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(opts.count(<span class="stringliteral">&quot;help&quot;</span>) || badargs) {</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; [OPTS]&quot;</span> &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; desc &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a name="a2"></a><a class="code" href="mujinjog_8cpp.html#a4ff756831d636c1b4c750f4260b26904" title="initialize BinPickingTask and establish communication with controller">InitializeTask</a>(<span class="keyword">const</span> bpo::variables_map&amp; opts,</div>
<div class="line">                    <a class="code" href="namespacemujinclient.html#a94060c5e195c463ab3731c0975afd19f">BinPickingTaskResourcePtr</a>&amp; pBinpickingTask)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> controllerUsernamePass = opts[<span class="stringliteral">&quot;controller_username_password&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> controllerCommandTimeout = opts[<span class="stringliteral">&quot;controller_command_timeout&quot;</span>].as&lt;<span class="keywordtype">double</span>&gt;();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> taskparameters = opts[<span class="stringliteral">&quot;taskparameters&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> locale = opts[<span class="stringliteral">&quot;locale&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> taskZmqPort = opts[<span class="stringliteral">&quot;zmq_port&quot;</span>].as&lt;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&gt;();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> hostname = opts[<span class="stringliteral">&quot;controller_hostname&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> controllerPort = opts[<span class="stringliteral">&quot;controller_port&quot;</span>].as&lt;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&gt;();</div>
<div class="line">    stringstream urlss;</div>
<div class="line">    urlss &lt;&lt; <span class="stringliteral">&quot;http://&quot;</span> &lt;&lt; hostname &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; controllerPort;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> heartbeatPort = opts[<span class="stringliteral">&quot;heartbeat_port&quot;</span>].as&lt;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&gt;();</div>
<div class="line">    <span class="keywordtype">string</span> slaverequestid = opts[<span class="stringliteral">&quot;slave_request_id&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line">    <span class="keywordtype">string</span> taskScenePk = opts[<span class="stringliteral">&quot;task_scenepk&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> needtoobtainfromheatbeat = taskScenePk.empty() || slaverequestid.empty();</div>
<div class="line">    <span class="keywordflow">if</span> (needtoobtainfromheatbeat) {</div>
<div class="line">        stringstream endpoint;</div>
<div class="line">        endpoint &lt;&lt; <span class="stringliteral">&quot;tcp:\/\/&quot;</span> &lt;&lt; hostname &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; heartbeatPort;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;connecting to heartbeat at &quot;</span> &lt;&lt; endpoint.str() &lt;&lt; endl;</div>
<div class="line">        <span class="keywordtype">string</span> heartbeat;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_try_heartbeat(5);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> it_try_heartbeat = 0; it_try_heartbeat &lt; num_try_heartbeat; ++it_try_heartbeat) {</div>
<div class="line">            heartbeat = utils::GetHeartbeat(endpoint.str());</div>
<div class="line">            <span class="keywordflow">if</span> (!heartbeat.empty()) {</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot;Failed to get heart beat &quot;</span> &lt;&lt; it_try_heartbeat &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; num_try_heartbeat &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">            boost::this_thread::sleep(boost::posix_time::seconds(1));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (heartbeat.empty()) {</div>
<div class="line">            <span class="keywordflow">throw</span> <a name="_a3"></a><a class="code" href="classmujinclient_1_1MujinException.html" title="Exception that all Mujin internal methods throw; the error codes are held in MujinErrorCode.">MujinException</a>(boost::str(boost::format(<span class="stringliteral">&quot;Failed to obtain heartbeat from %s. Is controller running?&quot;</span>)%endpoint.str()));</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (taskScenePk.empty()) {</div>
<div class="line">            taskScenePk = utils::GetScenePkFromHeatbeat(heartbeat);</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot;task_scenepk: &quot;</span> &lt;&lt; taskScenePk &lt;&lt; <span class="stringliteral">&quot; is obtained from heatbeat\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (slaverequestid.empty()) {</div>
<div class="line">            slaverequestid = utils::GetSlaveRequestIdFromHeatbeat(heartbeat);</div>
<div class="line">            cout &lt;&lt; <span class="stringliteral">&quot;slave_request_id: &quot;</span> &lt;&lt; slaverequestid &lt;&lt; <span class="stringliteral">&quot; is obtained from heatbeat\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//    cout &lt;&lt; taskparameters &lt;&lt; endl;</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> tasktype = <span class="stringliteral">&quot;realtimeitlplanning&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// connect to mujin controller</span></div>
<div class="line">    <a class="code" href="namespacemujinclient.html#aa0b8a533fc19b5930eca8bf825f2231d">ControllerClientPtr</a> controllerclient = <a name="a4"></a><a class="code" href="namespacemujinclient.html#a4154f688f4ec2cd2511ab6830a2777a7" title="creates the controller with an account. This function is not thread safe.">CreateControllerClient</a>(controllerUsernamePass, urlss.str());</div>
<div class="line"></div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;connected to mujin controller at &quot;</span> &lt;&lt; urlss.str() &lt;&lt; endl;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="namespacemujinclient.html#a9a7bf2721c91516d69ca08837e26b7b8">SceneResourcePtr</a> scene(<span class="keyword">new</span> <a name="_a5"></a><a class="code" href="classmujinclient_1_1SceneResource.html">SceneResource</a>(controllerclient, taskScenePk));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// initialize binpicking task</span></div>
<div class="line">    pBinpickingTask = scene-&gt;GetOrCreateBinPickingTaskFromName_UTF8(tasktype+<span class="keywordtype">string</span>(<span class="stringliteral">&quot;task1&quot;</span>), tasktype, <a name="a6"></a><a class="code" href="namespacemujinclient.html#a63510ac452480d92ed2e390b6eefd236a8e63065fb81db068288176845cc74e98" title="create a task resource with zeromq client">TRO_EnableZMQ</a>);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> userinfo = <span class="stringliteral">&quot;{\&quot;username\&quot;: \&quot;&quot;</span> + controllerclient-&gt;GetUserName() + <span class="stringliteral">&quot;\&quot;, &quot;</span><span class="stringliteral">&quot;\&quot;locale\&quot;: \&quot;&quot;</span> + locale + <span class="stringliteral">&quot;\&quot;}&quot;</span>;</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;initialzing binpickingtask with userinfo=&quot;</span> + userinfo &lt;&lt; <span class="stringliteral">&quot; taskparameters=&quot;</span> &lt;&lt; taskparameters &lt;&lt; endl;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="mujinjog_8cpp.html#a44f93965ae092cf23ff35997031b2415">s_robotname</a> = opts[<span class="stringliteral">&quot;robotname&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="mujinjog_8cpp.html#a44f93965ae092cf23ff35997031b2415">s_robotname</a>.empty()) {</div>
<div class="line">        vector&lt;SceneResource::InstObjectPtr&gt; instobjects;</div>
<div class="line">        scene-&gt;GetInstObjects(instobjects);</div>
<div class="line">        <span class="keywordflow">for</span> (vector&lt;SceneResource::InstObjectPtr&gt;::const_iterator it = instobjects.begin();</div>
<div class="line">             it != instobjects.end(); ++it) {</div>
<div class="line">            <span class="keywordflow">if</span> (!(**it).dofvalues.empty()) {</div>
<div class="line">                <a class="code" href="mujinjog_8cpp.html#a44f93965ae092cf23ff35997031b2415">s_robotname</a> = (**it).name;</div>
<div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;robot name: &quot;</span> &lt;&lt; <a class="code" href="mujinjog_8cpp.html#a44f93965ae092cf23ff35997031b2415">s_robotname</a> &lt;&lt; <span class="stringliteral">&quot; is obtained from scene\n&quot;</span>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="mujinjog_8cpp.html#a44f93965ae092cf23ff35997031b2415">s_robotname</a>.empty()) {</div>
<div class="line">            <span class="keywordflow">throw</span> <a class="code" href="classmujinclient_1_1MujinException.html" title="Exception that all Mujin internal methods throw; the error codes are held in MujinErrorCode.">MujinException</a>(<span class="stringliteral">&quot;Robot name was not given by command line option. Also, failed to obtain robot name from scene.\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">    boost::shared_ptr&lt;zmq::context_t&gt; zmqcontext(<span class="keyword">new</span> <a name="_a7"></a><a class="code" href="classzmq_1_1context__t.html">zmq::context_t</a>(1));</div>
<div class="line">    pBinpickingTask-&gt;Initialize(taskparameters, taskZmqPort, heartbeatPort, zmqcontext, <span class="keyword">false</span>, 10, controllerCommandTimeout, userinfo, slaverequestid);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">string</span> <a name="a8"></a><a class="code" href="mujinjog_8cpp.html#ae447300c5f038db628252d7d43395d36" title="convert state of bin picking task to string">ConvertStateToString</a>(<span class="keyword">const</span> <a name="_a9"></a><a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html">BinPickingTaskResource::ResultGetBinpickingState</a>&amp; state)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (state.<a name="a10"></a><a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a549366a57b8067953c7cbc55b078eeb7">currentJointValues</a>.empty() || state.<a name="a11"></a><a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a54f36496a978cd38e8420eff474f632d">currentToolValues</a>.size() &lt; 6) {</div>
<div class="line">        stringstream ss;</div>
<div class="line">        ss &lt;&lt; <span class="stringliteral">&quot;Failed to obtain robot state: joint values have &quot;</span></div>
<div class="line">           &lt;&lt; state.<a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a549366a57b8067953c7cbc55b078eeb7">currentJointValues</a>.size() &lt;&lt; <span class="stringliteral">&quot; elements and tool values have &quot;</span></div>
<div class="line">           &lt;&lt; state.<a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a54f36496a978cd38e8420eff474f632d">currentToolValues</a>.size() &lt;&lt; <span class="stringliteral">&quot; elements\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">throw</span> std::runtime_error(ss.str());</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    stringstream ss;</div>
<div class="line">    ss &lt;&lt; state.<a name="a12"></a><a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#ac4783eae0ea120569d0fbc0ac58e4add" title="ms">timestamp</a> &lt;&lt; <span class="stringliteral">&quot; (ms): joint:&quot;</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; state.<a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a549366a57b8067953c7cbc55b078eeb7">currentJointValues</a>.size(); ++i) {</div>
<div class="line">        ss &lt;&lt; state.<a name="a13"></a><a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a02e0eb3c474685d952f4f9e14cca7ac3">jointNames</a>[i] &lt;&lt; <span class="stringliteral">&quot;=&quot;</span> &lt;&lt; state.<a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a549366a57b8067953c7cbc55b078eeb7">currentJointValues</a>[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ss &lt;&lt; <span class="stringliteral">&quot;X=&quot;</span> &lt;&lt; state.<a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a54f36496a978cd38e8420eff474f632d">currentToolValues</a>[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">    ss &lt;&lt; <span class="stringliteral">&quot;Y=&quot;</span> &lt;&lt; state.<a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a54f36496a978cd38e8420eff474f632d">currentToolValues</a>[1] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">    ss &lt;&lt; <span class="stringliteral">&quot;Z=&quot;</span> &lt;&lt; state.<a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a54f36496a978cd38e8420eff474f632d">currentToolValues</a>[2] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">    ss &lt;&lt; <span class="stringliteral">&quot;RX=&quot;</span> &lt;&lt; state.<a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a54f36496a978cd38e8420eff474f632d">currentToolValues</a>[3] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">    ss &lt;&lt; <span class="stringliteral">&quot;RY=&quot;</span> &lt;&lt; state.<a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a54f36496a978cd38e8420eff474f632d">currentToolValues</a>[4] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">    ss &lt;&lt; <span class="stringliteral">&quot;RZ=&quot;</span> &lt;&lt; state.<a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html#a54f36496a978cd38e8420eff474f632d">currentToolValues</a>[5];</div>
<div class="line">    <span class="keywordflow">return</span> ss.str();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a name="a14"></a><a class="code" href="mujinjog_8cpp.html#a696d5e458ad0e868e9e99de4b8987c45" title="jogs robot either in joint space or tool space">Run</a>(<a class="code" href="namespacemujinclient.html#a94060c5e195c463ab3731c0975afd19f">BinPickingTaskResourcePtr</a>&amp; pTask,</div>
<div class="line">         <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; goaltype,</div>
<div class="line">         <span class="keyword">const</span> vector&lt;double&gt;&amp; goals,</div>
<div class="line">         <span class="keywordtype">double</span> speed,</div>
<div class="line">         <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; robotname,</div>
<div class="line">         <span class="keyword">const</span> <span class="keywordtype">string</span>&amp; toolname,</div>
<div class="line">         <span class="keywordtype">bool</span> movelinear)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// print state</span></div>
<div class="line">    <a class="code" href="structmujinclient_1_1BinPickingTaskResource_1_1ResultGetBinpickingState.html">BinPickingTaskResource::ResultGetBinpickingState</a> result;</div>
<div class="line">    pTask-&gt;GetPublishedTaskState(result, robotname, <span class="stringliteral">&quot;mm&quot;</span>, 1.0);</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Starting:\n&quot;</span> &lt;&lt; <a class="code" href="mujinjog_8cpp.html#ae447300c5f038db628252d7d43395d36" title="convert state of bin picking task to string">ConvertStateToString</a>(result) &lt;&lt; endl;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// start moving</span></div>
<div class="line">    <span class="keywordflow">if</span> (movelinear) {</div>
<div class="line">        pTask-&gt;MoveToolLinear(goaltype, goals, robotname, toolname, speed);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        pTask-&gt;MoveToHandPosition(goaltype, goals, robotname, toolname, speed);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// print state</span></div>
<div class="line">    pTask-&gt;GetPublishedTaskState(result, robotname, <span class="stringliteral">&quot;mm&quot;</span>, 1.0);</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Finished:\n&quot;</span> &lt;&lt; <a class="code" href="mujinjog_8cpp.html#ae447300c5f038db628252d7d43395d36" title="convert state of bin picking task to string">ConvertStateToString</a>(result) &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> <a name="a15"></a><a class="code" href="mujinbinpickingtask_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// parsing options</span></div>
<div class="line">    bpo::variables_map opts;</div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="mujinjog_8cpp.html#a6f58488a42ca5b7dd063aa3a7641e60e" title="parse command line options and store in a map">ParseOptions</a>(argc, argv, opts)) {</div>
<div class="line">        <span class="comment">// parsing option failed</span></div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> robotname = opts[<span class="stringliteral">&quot;robotname&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> toolname = opts[<span class="stringliteral">&quot;toolname&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line">    <span class="keyword">const</span> vector&lt;double&gt; goals = opts[<span class="stringliteral">&quot;goals&quot;</span>].as&lt;vector&lt;double&gt; &gt;();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">string</span> goaltype = opts[<span class="stringliteral">&quot;goaltype&quot;</span>].as&lt;<span class="keywordtype">string</span>&gt;();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">double</span> speed = opts[<span class="stringliteral">&quot;speed&quot;</span>].as&lt;<span class="keywordtype">double</span>&gt;();</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">bool</span> movelinearly = opts[<span class="stringliteral">&quot;movelinear&quot;</span>].as&lt;<span class="keywordtype">bool</span>&gt;();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// initializing</span></div>
<div class="line">    <a class="code" href="namespacemujinclient.html#a94060c5e195c463ab3731c0975afd19f">BinPickingTaskResourcePtr</a> pBinpickingTask;</div>
<div class="line">    <a class="code" href="mujinjog_8cpp.html#a4ff756831d636c1b4c750f4260b26904" title="initialize BinPickingTask and establish communication with controller">InitializeTask</a>(opts, pBinpickingTask);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// do interesting part</span></div>
<div class="line">    <a class="code" href="mujinjog_8cpp.html#a696d5e458ad0e868e9e99de4b8987c45" title="jogs robot either in joint space or tool space">Run</a>(pBinpickingTask, goaltype, goals, speed, <a class="code" href="mujinjog_8cpp.html#a44f93965ae092cf23ff35997031b2415">s_robotname</a>, toolname, movelinearly);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 21 2016 19:44:48 for controllerclientcpp by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
